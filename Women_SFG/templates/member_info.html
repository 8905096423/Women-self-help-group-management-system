<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />
  
    <title>SFG</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <link rel="stylesheet" href="{{url_for('static',filename='css/bootstrap.css')}}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="{{url_for('static',filename='css/font-awesome.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static',filename='css/style.css')}}">
    <!-- fonts style -->
    <link rel="stylesheet" href="{{url_for('static',filename='css/responsive.css')}}">
  
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body ng-controller="MemberController">
    <header class="header_section">
        <div class="header_bottom" style="background-color:rgba(148, 89, 11, 0.865);">
            <div class="container-fluid">
                <nav class="navbar navbar-expand-lg custom_nav-container ">
                    <a class="navbar-brand" href="index.html">
                      <img src="{{url_for('static',filename='images/logo2.jpg')}}" alt="" style="width: 60px; height:60px;">
    
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class=""> </span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item active">
                                <a class="nav-link" href="/" style="font-size:18px;font-weight:bold;">Home <span class="sr-only">(current)</span></a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="groupDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size:18px;font-weight:bold;">
                                    GROUP
                                </a>
                                <div class="dropdown-menu" aria-labelledby="groupDropdown">
                                    <a class="dropdown-item" href="/group.html" style="font-size:18px;font-weight:bold;">Create New Group</a>
                                    <a class="dropdown-item" href="/group.html" style="font-size:18px;font-weight:bold;">Manage Existing Group</a>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="" style="font-size:18px;font-weight:bold;">Login</a>
                            </li>
                            <form class="form-inline">
                                <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </button>
                            </form>
                        </ul>
                       
                    </div>
                </nav>
            </div>
        </div>
    </header>
    

    
    <h1>{{ group_name }}</h1>
<p>{{ group_description }}</p>
{% set members_data = members %}

<button id="add-leader-btn">Add Group Leader</button>
<br>
<div id="members-container">
    {% for member in members_data %}
    <div>
        <h2>Member {{ member[0] }}</h2>
        <form>
            <label for="member_id">Member ID:</label>
            <input type="text" id="member_id" value="{{ member[0]}}" required readonly><br>

            <label for="name">Name:</label>
            <input type="text" id="name" value="{{ member[1]}}" required readonly><br>
            
            <label for="age">Age:</label>
            <input type="number" id="age" value="{{ member[2] }}" required readonly><br>
            
            <label for="address">Address:</label>
            <input type="text" id="address" value="{{ member[3] }}" required readonly><br>
  

           <label for="phNo">Phone:</label>
            <input type="text" id="phNo" value="{{ member[4] }}" required readonly><br>

            
            <button type="button" onclick="toggleEdit(this)">Edit</button>
            <button type="button" onclick="deleteMember(this)">Delete</button>
            <button type="submit" id="save-button" onclick="saveMember(this)" >Save</button>

        </form>
        <hr>
    </div>
    {% endfor %}
</div>

<button id="add-member-btn">Add Member</button>

<script>
    
   function toggleEdit(button) {
    var form = button.closest('form');
    var inputs = form.querySelectorAll('input');
    inputs.forEach(function(input) {
        // Exclude member_id field from being toggled
        if (input.id !== 'member_id') {
            input.readOnly = !input.readOnly;
        }
    });
   
}

    function deleteMember(button) {
        var memberId = button.closest('div').querySelector('#member_id').value; // Extracting member ID
        var form = button.closest('div');
        
        // Ask for confirmation
        var confirmDelete = confirm('Are you sure you want to delete member ' + memberId + '?');

        if (confirmDelete) {
            // If confirmed, proceed with deletion
            fetch(`/delete-member/${memberId}`, {  // Use backticks (`) to include variables in a string
    method: 'POST',
})
.then(response => {
                if (response.ok) {
                    form.remove(); // Remove the member from the UI
                } else {
                    alert('Failed to delete member');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    }




    document.getElementById("add-member-btn").addEventListener("click", function() {
    
    var container = document.getElementById("members-container");
    var newMemberIndex = container.childElementCount + 1;

    fetch('/get_data')
    .then(response => response.json())
    .then(data => {
        // Store the returned value in a client-side variable
        const serverMessage = data.message;
        console.log('Message from server:', serverMessage);

        // Create and append newMemberDiv after receiving the response
        var newMemberDiv = document.createElement("div");
        container.appendChild(newMemberDiv);

        newMemberDiv.innerHTML = `
            <h2>Member ${newMemberIndex}</h2>
            <form>
                <label for="member_id">Member ID:</label>
                <input type="text" id="member_id" value="${serverMessage}" readonly><br>

                <label for="name">Name:</label>
                <input type="text" id="name" required readonly><br>
                
                <label for="age">Age:</label>
                <input type="number" id="age" required readonly><br>
                
                <label for="address">Address:</label>
                <input type="text" id="address" required readonly><br>
                
                <label for="phNo">Phone:</label>
                <input type="text" id="phNo" required readonly><br>

                <button type="button" onclick="toggleEdit(this)">Edit</button>
                <button type="button" onclick="deleteMember(this)">Delete</button>
                <button type="submit" id="save-button" onclick="saveMember(this)">Save</button>
            </form>
            <hr>
        `;
    })
    .catch(error => console.error('Error:', error));
});





     function saveMember(button){
        var memberId = button.closest('div').querySelector('#member_id').value; // Extracting member ID
        var name = button.closest('div').querySelector('#name').value;
        var age = button.closest('div').querySelector('#age').value;
        var address = button.closest('div').querySelector('#address').value;
        var ph_no = button.closest('div').querySelector('#phNo').value;
       
        var form = button.closest('div');
        
        
        var confirmDelete = confirm('Are you sure you want to Save  the new changes ?' );
        if (confirmDelete) {
            
            fetch(`/save-member/${memberId}/${name}/${age}/${address}/${ph_no}`, {  // Use backticks (`) to include variables in a string
    method: 'POST',
})
.then(response => {
                if (response.ok) {
                    alert('Changes saved successfully!'); // Remove the member from the UI
                } else {
                    alert('Failed to Save the changes');
                }
            })
            .catch(error => console.error('Error:', error));
        }
     }

    
</script>


  

    <script src="{{url_for('static',filename='js/jquery-3.4.1.min.js')}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="{{url_for('static',filename='js/bootstrap.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script src="https://huynhhuynh.github.io/owlcarousel2-filter/dist/owlcarousel2-filter.min.js"></script>
    <script src="{{url_for('static',filename='js/custom.js')}}"></script> 
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>